function config($routeProvider){$routeProvider.when("/users/",{templateUrl:"templates/users.html",controller:"UsersController",controllerAs:"usersCtrl"}).when("/user/:userId",{templateUrl:"templates/user_details.html",controller:"UserDetailsController",controllerAs:"userDetailsCtrl"}).otherwise({redirectTo:"/users/"})}angular.module("UserStatus",["UserStatus.Controllers","UserStatus.Services","ngRoute","ngCookies"]).config(config),angular.module("UserStatus.Controllers",[]).controller("UsersController",function(UsersService){var that=this;that.loadingProcess=!0,that.loadError=!1,UsersService.getUsersList().then(function(userslist){that.users=userslist,that.loadingProcess=!1})["catch"](function(err){that.loadError=!0,that.loadingProcess=!1})}).controller("UserListController",function($scope,$location,LocaleService){var that=this;that.localeParams=LocaleService.getLangParams(),$scope.$on("language_changed",function(event,params){that.localeParams=params}),that.editUser=function(id){$location.path("/user/"+id)}}).controller("UserDetailsController",function($scope,$routeParams,UsersService,$location,$timeout){var that=this;that.userId=$routeParams.userId,that.user={},that.changed=!1,that.savedUser={},that.loadingProcess=!0,that.loadError=!1,that.statuses=["online","offline"],UsersService.getUser(that.userId).then(function(user){that.user=user[0],that.savedUser.status=user[0].status,that.loadingProcess=!1})["catch"](function(){that.loadError=!0,that.loadingProcess=!1,$timeout(function(){that.gotoUsers()},3e3)}),that.saveChanges=function(){UsersService.updateUser(that.user),that.savedUser.status=that.user.status,that.changed=!1},that.gotoUsers=function(){that.user.status=that.savedUser.status,$location.path("/user/")}}).controller("LocaleController",function($scope,LocaleService){var that=this;that.currentLanguage=LocaleService.getLanguage(),that.languages=LocaleService.getLanguages(),that.localeParams=LocaleService.getLangParams(),that.setLocale=function(lang){that.localeParams=LocaleService.setLangParams(lang),that.currentLanguage=lang},$scope.$on("language_changed",function(event,params){that.localeParams=params})}),angular.module("UserStatus").directive("gravatar",function(){return{restrict:"E",templateUrl:"../templates/gravatar.html",replace:!0,scope:{photoSrc:"="}}}).directive("userList",function(){return{restrict:"E",templateUrl:"../templates/userlist.html",controller:"UserListController",controllerAs:"userListCtrl",scope:{users:"=",searchText:"=",enableSearch:"=",localeParams:"="}}}),angular.module("UserStatus.Services",[]).factory("UsersService",function($q,$http,$cookies){var service={};$cookies.remove("users_list");var users=[],compareNames=function(a,b){var textA=a.name.first.toUpperCase(),textB=b.name.first.toUpperCase();return textB>textA?-1:textA>textB?1:0},fixStatuses=function(a){return a.status=a.status?a.status:"empty",a};return service.getUsersList=function(){var deferred=$q.defer();return users.length?deferred.resolve(users):$http.get("../users.json").then(function(response){users=response.data.sort(compareNames).map(fixStatuses),$cookies.put("users_list",JSON.stringify(users)),deferred.resolve(users)},function(){deferred.reject()}),deferred.promise},service.getUser=function(userId){var deferred=$q.defer();return users.length?deferred.resolve(users.filter(function(a){return a.id===userId})):$http.get("../users.json").then(function(response){users=response.data.sort(compareNames).map(fixStatuses),$cookies.put("users_list",JSON.stringify(users)),deferred.resolve(users.filter(function(a){return a.id===userId}))},function(){deferred.reject()}),deferred.promise},service.updateUser=function(user){for(var i in users)if(users[i].id==user.id){users[i]=user,$cookies.put("users_list",JSON.stringify(users));break}},service}).factory("LocaleService",function($rootScope,$http,$cookies){var locale={},languages=["en","de","uk"],default_lang="en";locale.langParams={};var language=$cookies.get("language")||window.navigator.userLanguage||window.navigator.language;locale.getLanguages=function(){return languages},locale.setLangParams=function(lang){return lang&&-1!==languages.indexOf(lang)||(lang=default_lang),$http.get("scripts/locale/"+lang+".txt").success(function(data){locale.langParams=parseParameters(data),$cookies.put("language",lang),$cookies.put("language_parameters",locale.langParams),$rootScope.$broadcast("language_changed",locale.langParams)}),locale},locale.setLangParams(language),locale.getLangParams=function(){return locale.langParams},locale.getLanguage=function(){return language};var parseParameters=function(data){for(var lines=data.split(/\r\n|\n\r|\n|\r/g),arrLength=lines.length,objectParams={},tmpItem=[],i=0;arrLength>i;i++)tmpItem=lines[i].split("="),2===tmpItem.length&&(objectParams[tmpItem[0]]=tmpItem[1]);return objectParams};return locale});